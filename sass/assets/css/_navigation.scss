/*
  Navigation Partial
  ------------------
  Updated to match new HTML structure with <span> wrappers
  for all nav items.

  Now uses dedicated navbar theme variables for the bar itself,
  while dropdowns retain the page theme.
*/

@use 'variables' as *;

#nav-container {
  width: 100%;
  height: 100%;
  max-width: $container-width;
  margin-inline: auto;
  padding-inline: $spacing-base * 1.5 0; // 24px padding
}

nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 100%;
}

#nav-logo {
  display: flex;
  height: 100%;
  align-items: center;
  text-decoration: none;
  font-weight: bold;
  font-size: 1.5em;
  flex-shrink: 0; // Prevent logo from shrinking
  &:hover {
    text-decoration: none; // No underline on logo
  }
}

#nav-logo img {
  max-height: $header-height * 0.75;
}

#logo-text-oly {
  color: #fcfcfc;
}

#logo-text-prep {
  color: #e97d28;
}

// --- Toggles (Mobile Menu + Dropdown) ---
.menu-toggle,
.dropdown-menu-toggle {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--nav-text-color); // Use nav text color
  font-size: 1.5rem;
  padding: 0 $spacing-base * 1.5;
  z-index: 110; // Above nav menu
}

.dropdown-menu-toggle {
  font-size: 0.8rem; // Smaller '▼'

  > span {
    display: inline-block; // Important for transform to work
    transition: transform 0.2s ease-in-out;
    transform-origin: center;
  }
}

// --- Mobile-First Menu Styles (Default) ---
// The mobile dropdown menu uses the page theme, not nav theme
#nav-menu {
  // Hide menu off-screen by default
  display: none;
  position: absolute;
  top: $header-height;
  left: 0;
  width: 100%;
  background-color: var(--nav-bg-color); // Page theme
  border-bottom: 1px solid var(--border-color); // Page theme
  padding: $spacing-base 0;

  // JS Toggles This Class
  &.active {
    display: block;
  }

  li {
    list-style: none;
    &:hover {
      text-decoration: none;
    }
  }

  // General rule for all nav links (inside spans)
  li > span > a {
    display: block;
    padding: $spacing-base $spacing-base * 1.5;
    color: var(--nav-text-color);
    font-weight: 500;
    &:hover {
      text-decoration: none;
    }
  }

  // Dropdown parent LI
  li:has(#nav-olympiad) {
    display: flex;
    flex-wrap: wrap; // The span and the ul will wrap
    align-items: center;
    padding: 0; // No padding on the LI
  }

  // This is the new SPAN wrapper for the dropdown
  #nav-olympiad {
    display: flex;
    align-items: center;
    flex-grow: 1; // Make the span take up the full width on line 1

    // This is the "Olympiads" link
    > a {
      display: inline-block; // Override the 'display: block'
      width: auto;
      flex-grow: 1; // Link takes leftover space *within the span*
      // It inherits padding and font-weight, which is what we want.

      &:hover {
        background-color: transparent; // Hover is on parent
      }
    }

    // This is the '▼' button
    > button {
      flex-shrink: 0; // Don't shrink
      padding: $spacing-base $spacing-base * 1.5;
      color: var(--nav-text-color); // Mobile dropdown uses page text color
    }
  }
}

// Mobile Dropdown Menu
#nav-dropdown-menu {
  flex-basis: 100%; // Force this to a new line

  display: none;
  width: 100%; // Full width in mobile
  padding-left: $spacing-base * 1.5; // Indent dropdown links

  &.active {
    display: block;
  }

  // Links inside the dropdown (now also in spans)
  span > a {
    font-weight: 400;
    font-size: 0.95rem;

    &:hover {
      background-color: var(--nav-bg-color); // Different hover for dropdown
    }
  }
}

// Flip arrow when dropdown is open (MOBILE ONLY)
@media (max-width: $breakpoint-tablet - 1px) {
  li:has(#nav-dropdown-menu.active) #nav-olympiad .dropdown-menu-toggle > span {
    transform: rotate(180deg);
  }
}

// --- Tablet & Desktop Styles ---
@media (min-width: $breakpoint-tablet) {

  #nav-container {
    padding-inline: $spacing-base * 1.5; // 24px padding
  }

  // Hide mobile hamburger
  .menu-toggle {
    display: none;
  }

  // Show desktop menu
  #nav-menu {
    display: flex;
    position: static;
    width: auto;
    border: none;
    background-color: transparent;
    padding: 0;
    align-items: stretch;
    gap: $spacing-base;
    height: 100%;

    // Target the <span> for simple links (not dropdown)
    > li > span:not(#nav-olympiad) {
      display: flex;
      align-items: center;
      height: 100%;
      border-radius: $border-radius / 2;
      transition: background-color 0.2s ease-in-out;

      &:hover {
        background-color: var(--nav-bg-secondary); // Nav theme hover
      }

      > a {
        display: flex;
        align-items: center;
        height: 100%;
        padding: $spacing-base / 2 $spacing-base;
        color: var(--nav-text-color); // Nav theme text
        &:hover {
          background-color: transparent;
          color: var(--accent-color);
          text-decoration: none;
        }
      }
    }

    // Dropdown parent LI
    li:has(#nav-olympiad) {
      display: flex;
      flex-wrap: nowrap;
      position: relative;
      padding: 0;
    }

    // Dropdown SPAN
    #nav-olympiad {
      display: flex;
      align-items: center;
      flex-grow: 0;
      height: 100%;
      border-radius: $border-radius / 2;
      transition: background-color 0.2s ease-in-out;

      &:hover {
        background-color: var(--nav-bg-secondary); // Nav theme hover
      }

      > a {
        display: inline-block;
        flex: 0 1 auto;
        color: var(--nav-text-color); // Nav theme text
        // --- PADDING ADJUSTED ---
        padding-top: $spacing-base / 2;
        padding-bottom: $spacing-base / 2;
        padding-left: $spacing-base;
        padding-right: $spacing-base / 4; // Reduced from $spacing-base
        width: auto;
        height: 100%;
        align-content: center;


        &:hover {
          color: var(--accent-color);
        }
      }

      > button {
        color: var(--nav-text-color); // Nav theme text
        // --- PADDING ADJUSTED ---
        padding-top: $spacing-base / 2;
        padding-bottom: $spacing-base / 2;
        padding-left: $spacing-base / 4; // Reduced from $spacing-base / 2
        padding-right: $spacing-base; // Changed from $spacing-base / 2
      }
    }
  }

  // Desktop Dropdown Menu
  // This uses the page theme, not the nav theme
  #nav-dropdown-menu {
    position: absolute;
    top: calc(($header-height - 100%) / 2 + 100%);
    left: 0;
    width: 100%;
    background-color: var(--nav-bg-color); // Page theme
    border: 1px solid var(--border-color); // Page theme
    border-radius: 0; // Changed from $border-radius
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    padding-left: 0;
    flex-basis: auto;

    &.active {
      display: none;
    }

    // Show *only* on hover on desktop
    li:has(#nav-olympiad):hover & {
      display: block;
    }

    // Links inside dropdown (in spans)
    span > a {
      display: block;
      font-weight: 400;
      font-size: 1rem;
      padding: $spacing-base * 0.75 $spacing-base;
      border-radius: 0; // Changed from $border-radius / 2
      &:hover {
        background-color: var(--nav-bg-secondary); // Page theme
        color: var(--accent-color); // Page theme
        text-decoration: none;
      }
    }
  }

  // --- Flip arrow <span> on desktop *hover* ---
  li:has(#nav-olympiad):hover #nav-olympiad .dropdown-menu-toggle > span {
    transform: rotate(180deg);
  }
}
