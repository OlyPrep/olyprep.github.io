{% import "snippet.html" as snippet %}
{% extends "base.html" %}

{% block html_class %}{% endblock html_class %}

{% block header %}
{% endblock header %}

{% block body_class %}
{% endblock body_class %}

{% block content %}

{% set path = page.path | split(pat="/") %}
{% set olympiad_map = load_data(path="content/olympiad/" ~ path[2] ~ "/map.json", format="json") %}
{% set unit_map = olympiad_map[path[3]] %}

{% set lesson_list = [] %}
{% for group_name, lessons in unit_map %}
  {% for lesson in lessons %}
    {% set_global lesson_list = lesson_list | concat(with=lesson) %}
    {% set_global group = group_name %}
  {% endfor %}
{% endfor %}

{% set lesson_index = -1 %}
{% for page in lesson_list %}
  {% if page == path[4] %}
    {% set_global lesson_index = loop.index0 %}
  {% endif %}
{% endfor %}

{% if lesson_index > 0 %}
  {% set index = lesson_index - 1 %}
  {% set_global prev_lesson = lesson_list[index] %}
{% endif %}

{% if lesson_index != -1 and lesson_index < lesson_list | length - 1 %}
  {% set index = lesson_index + 1 %}
  {% set_global next_lesson = lesson_list[index] %}
{% endif %}

<div id="sidebar-overlay" class="sidebar-overlay"></div>
<div class="columns">
  <div id="sidebar" class="column sidebar-column">
    <div>
      {{ snippet::navbar(fixed=false, compact=true) }}
      <aside class="menu sticky-sidebar">
        <ul class="menu-list">
          {% for group, lessons in unit_map %}
          <li>
            <details class="collapse sidebar-collapse" open="">
              <summary>{{ group }}</summary>
              <ul>
                {% for lesson_id in lessons %}
                {% set lesson = get_page(path='olympiad/' ~ path[2] ~ '/' ~ path[3] ~ '/' ~ lesson_id ~ '.md') %}
                <li>
                  <a href="{{ get_url(path=lesson.path) }}">
                    <span class="mr-2"><i class="fa-solid fa-book-open"></i></span>
                    {{ lesson.title }}
                  </a>
                </li>
                {% endfor %}
              </ul>
            </details>
          </li>
          {% endfor %}
        </ul>
      </aside>
    </div>
  </div>
  <div class="sidebar-close">
    <a id="sidebar-close-button" class="button is-hidden-desktop"><i class="fa-solid fa-angles-left"></i></a>
  </div>
  <div class="column main-column main-content-parent">
    <div class="breadcrumb-container">
      <div class="container is-max-desktop">
        <div class="level breadcrumb-level is-mobile">
          <div class="level-left">
            <a id="sidebar-open-button" class="button is-hidden-desktop"><i class="fa-solid fa-angles-right"></i></a>
            <a class="is-hidden-mobile mx-2 my-2" {% if prev_lesson %} href="{{ get_url(path='olympiad/' ~ path[2] ~ '/' ~ path[3] ~ '/' ~ prev_lesson ~ '/') }}" {% else %} disabled {% endif %}><i class="fa-solid fa-angle-left"></i>Prev</a>
          </div>
          <div class="level-item has-text-centered is-hidden-mobile">
            <nav class="breadcrumb" aria-label="breadcrumbs">
              <ul>
                <li><a class="my-2" href="{{ get_url(path='olympiad/' ~ path[2] ~ '/') }}">IOI</a></li>
                <li><a class="my-2" href="{{ get_url(path='olympiad/' ~ path[2] ~ '/' ~ path[3] ~ '/') }}">Introduction</a></li>
                <li class="is-active"><a class="my-2" aria-current="page">{{ page.title }}</a></li>
              </ul>
            </nav>
          </div>
          <div class="level-right">
            <a class="is-hidden-tablet mx-2 my-2" {% if prev_lesson %} href="{{ get_url(path='olympiad/' ~ path[2] ~ '/' ~ path[3] ~ '/' ~ prev_lesson ~ '/') }}" {% else %} disabled {% endif %}><i class="fa-solid fa-angle-left"></i>Prev</a>
            <a class="mx-2 my-2" {% if next_lesson %} href="{{ get_url(path='olympiad/' ~ path[2] ~ '/' ~ path[3] ~ '/' ~ next_lesson ~ '/') }}" {% else %} disabled {% endif %}>Next <i class="fa-solid fa-angle-right"></i></a>
          </div>
        </div>
      </div>
    </div>
    <div class="main-content">
      <div class="container is-max-desktop">
        <section class="section">
          <h1 class="title is-1">{{ page.title }}</h1>
          <div class="content">
            {{ page.content | safe }}
          </div>
        </section>
      </div>
    </div>
    {{ snippet::footer() }}
  </div>
</div>
{% endblock content %}

{% block footer %}
{% endblock footer %}
